<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:vo="be.nascom.airbob.vo.*" 
	width="100%"
	verticalScrollPolicy="off"
	horizontalScrollPolicy="off"
	creationComplete="init()" >		
	<mx:Script>
		<![CDATA[
			import be.nascom.airbob.events.ForceBuildEvent;
			import flash.net.navigateToURL;
			import mx.events.StateChangeEvent;
			import mx.logging.Log;
			import mx.logging.ILogger;
			import caurina.transitions.Tweener;
			import mx.core.Window;
			
			private var block:ProjectBlock;
			private var status:ProjectStatus;
			
			private static var logger:ILogger = Log.getLogger("DashboardProjectView");
			
			private function openSite():void
			{
				navigateToURL(new URLRequest(project.webUrl));
			}
			
			private function init() :void 
			{				
				project.addEventListener(DashboardProject.EVENT_ACTIVITY_CHANGE, handleActivityChange);
				
				block = new ProjectBlock();	
				block.gotoAndStop(project.state.toLowerCase());
				
				status = new ProjectStatus();
				status.gotoAndStop(project.state.toLowerCase());
													
				backgroundContainer.addChild(block);
				statusContainer.addChild(status);
				
				resize();
			}
			
			private function handleActivityChange(event:Event) :void 
			{
				currentState = project.state;
				status.gotoAndStop(project.state.toLowerCase());
				block.gotoAndStop(project.state.toLowerCase());
			}
			
			private function resize():void 
			{
				try 
				{					
					block.width = backgroundContainer.width;
					block.height = backgroundContainer.height;
				} 
				catch (error:Error) 
				{
					logger.debug(error.toString());
				}
			}		  	
			
			override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void 
			{
				super.updateDisplayList(unscaledWidth, unscaledHeight);
				resize();
			}											
			
			private function forceBuild():void 
			{
				new ForceBuildEvent(project).dispatch();	
			}				

		]]>
	</mx:Script>
		
	<mx:states>
		<mx:State name="Success">	
		</mx:State>
		<mx:State name="Building">	
			<mx:SetProperty target="{labelForceBuild}" name="visible" value="false"/>
			<mx:SetProperty target="{labelInfo}" name="text" value="{project.activity}" />			
		</mx:State>
		<mx:State name="Failure">
		</mx:State>
		<mx:State name="Inactive"/>
	</mx:states>
	
	<mx:UIComponent id="backgroundContainer" width="100%" height="100%"/>
	<mx:UIComponent id="statusContainer" height="100%" />
	
	<vo:DashboardProject id="project" />
	
	<mx:Label id="labelInfo" text="Last successfull build: {project.lastBuildTime.replace('T', ' ')}" x="20" y="27" styleName="smallText" color="#333333"/>
	<mx:Label id="labelProjectName" x="20" y="4" text="{project.name}" color="#333333" styleName="smallText" />
	<mx:Label id="labelForceBuild" text="Force" styleName="smallText" buttonMode="true" mouseChildren="false" click="forceBuild()" y="2" right="37" color="#333333"/>
	<mx:Label id="labelMoreInfo" text="Info" styleName="smallText" right="10"  buttonMode="true" mouseChildren="false" click="openSite()" y="4" color="#333333"/>	
</mx:Canvas>
