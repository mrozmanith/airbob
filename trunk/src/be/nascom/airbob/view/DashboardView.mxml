<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:view="be.nascom.airbob.view.*" 	
	creationComplete="init()"
	currentState="{model.connectedState}"
	currentStateChange="handleCurrentStateChange(event)"
	horizontalScrollPolicy="off" >
	
	<mx:states>
		<mx:State name="connected">		
		</mx:State>
		<mx:State name="disconnected">		
		</mx:State>
	</mx:states>
	
	<mx:VBox width="100%" left="15" right="15" top="30">	
		<mx:Repeater id="projectRepeater" dataProvider="{model.projects}">
			<view:DashboadProjectView project="{projectRepeater.currentItem}" currentState="{projectRepeater.currentItem.state}" />										
		</mx:Repeater>				
	</mx:VBox>
	
	<mx:Script>
		<![CDATA[
			import mx.events.StateChangeEvent;
			import be.nascom.airbob.model.AppModelLocator;
			import mx.logging.Log;
			import mx.logging.ILogger;
			import mx.rpc.events.FaultEvent;
			import mx.collections.ArrayCollection;
		  	import mx.collections.XMLListCollection;
		  	import mx.rpc.events.ResultEvent;
		  	
		  	[Bindable]
		  	public var model:AppModelLocator = AppModelLocator.getInstance();
		  	
		  	[Bindable]
		  	private var connectedText:String;
		  	
		  	private var blockHeight:int = 50;
		  	
		  	private static var logger:ILogger = Log.getLogger("Dashboard");		
		  	
		  	private function init():void 
		  	{
		  		model.addEventListener(AppModelLocator.EVENT_MODEL_UPDATED, handleModelUpdated);
		  	}  
		  	
		  	private function handleModelUpdated(event:Event):void 
		  	{
		  		calculateHeight("connected");
		  	}		  
		  	
		  	private function handleCurrentStateChange(event:StateChangeEvent):void 
		  	{
		  		calculateHeight(event.newState);
		  	}
		  	
		  	private function calculateHeight(state:String):void
		  	{
		  		var appHeight:int = blockHeight;
	  			if (state=="disconnected") 
		  		{
		  			this.parentApplication.height=appHeight;
		  		} 
		  		else 
		  		{
		  			appHeight+=((blockHeight)*(model.projects.length+1));
		  			this.parentApplication.height=appHeight;
		  		}	
		  		logger.debug("Calculate height: " + appHeight);
		  	}	
		  			  			 	
		]]>
	</mx:Script>
	
</mx:Canvas>
